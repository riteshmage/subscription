<?php 
if($this->subscrptionStatus($this->getProductid()))
{ ?>
<div id="div_subscription">
<?php 
	$discountDetails = $this->discountDetail();
	if(!empty($discountDetails))
	{
		$disText = Thycart_Subscription_Block_Subscription::DISCOUNT_CONFIG;
		$currencyCode = Mage::app()->getStore()->getCurrentCurrencyCode();
		$currency = Mage::app()->getLocale()->currency($currencyCode)->getSymbol(); 
	?>
	<label>Subscrption </label>
	<select id="subscription_list">
		<option value="">Select Subscription</option>
		<?php foreach($discountDetails as $detail) { ?>
			<?php if(isset($detail['available_units'])) {	
				foreach($detail['available_units'] as $key=>$unit) { ?>
			<option value="<?php echo $key ?>" data-unit="<?php echo $unit;?>" data-value="<?php echo $detail['discount_value'];?>" data-type="<?php echo $detail['discount_type'] ?>">
				<?php echo $unit.' - '.$currency.$detail['discount_value'].$disText[$detail['discount_type']]; ?>
			</option>
			<?php } 
			} 
		} ?>
	</select>
	<button type="button" title="Subscribe" id="btnSubscription" class="button btn-cart" >Subscribe & Checkout</button>
	<div class="center">OR</div>
	<div class="subscriptionInputDiv" id="subscriptionInputDiv"></div>
</div>
<?php 
	} 
}
?>
<script type="text/javascript">
	var unit ='';
	jQuery('#subscription_list').change(function()
	{
		jQuery('.subscriptionInputs').remove();
		var subscriptionDetails = jQuery('#subscription_list').val();

		if(subscriptionDetails != '')
		{
			jQuery('#product_addtocart_form #subscriptionInputDiv').append(jQuery('<input>').attr({ 
				type:'hidden',  
				id:'unit', 
				name:'unit',
				class :'subscriptionInputs',
				value:jQuery(this).find('option:selected').data('unit')
			}));
			jQuery('#product_addtocart_form #subscriptionInputDiv').append(jQuery('<input>').attr({ 
				type:'hidden',  
				id:'discount_type',
				class :'subscriptionInputs',
				name:'discount_type',
				value:jQuery(this).find('option:selected').data('type')
			}));
			jQuery('#product_addtocart_form #subscriptionInputDiv').append(jQuery('<input>').attr({ 
				type:'hidden',  
				id:'discount_value',
				class :'subscriptionInputs',
				name:'discount_value',
				value:jQuery(this).find('option:selected').data('value')
			}));
		}
	});

	jQuery('#btnSubscription').click(function()
	{
		var subscriptionDetails = jQuery('#subscription_list').val();
    	if(subscriptionDetails == '')
    	{
    		alert('Please select subscription');
    		return false;	
    	}
   		productAddToCartForm.submit(this,'btnSubscription');
	});
</script>
